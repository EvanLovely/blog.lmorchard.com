---
title: Static blog generation with Gulp and S3
tags: [metablogging, webdev, js, gulp, jekyll, wordpress]
draft: true
---

So, last weekend, I was playing with microblogging and static web publishing.
But, I've been threatening (myself?) for ages to move my blog-proper to simple
static hosting like Amazon S3. 

<!--more-->

I've long agreed that many sites, like blogs, are better [baked than
fried][bake]. It makes for web hosting that's cheaper to run and simpler to
maintain. I've also often thought that [using a database can be an
anti-pattern][antidatabase] for managing content. 

But, what I've also found is that statically generated sites (i.e. baked)
often yield a poor writing environment.

## From WordPress to Jekyll to WordPress

[As I've mentioned before][platforms], I've flirted with a variety of
platforms for putting stuff from my brain on the web. The last time I switched
away from WordPress to Jekyll, I ended up switching right back again.

Jekyll took *way* too long to generate any previews for my site and its 1150
posts, and I couldn't figure out how to speed that up without moving files
around.  I tried a few different external tools like [Mou](http://25.io/mou/)
and [Marked](http://marked2app.com/), but the process never clicked.  I've
also never quite gotten along with Ruby, so I didn't get far with hacking on
Jekyll to scratch my own itches.

On the other hand, though WordPress has a nicer writing experience, it's
clunky in other ways. I'm always worried about all that PHP code sitting
around frying up page views, and I'm hoping no one figures out how to get at
the publishing machinery. I'm also less happy to hack on PHP, these days.

## Gulp is great

The place where I've been having a lot of hacking fun over the past few years
is node.js. So, when I was thinking about trying static hosting for
my blog again, I started looking into node.js-based Jekyll clones.

But then, it occurred to me that [Gulp][] would be a fine tool for the job,
and a good [saw-sharpening][sharpen] opportunity to boot. In a nutshell, where
unix tools pipe character/byte streams between tools, Gulp pipes streams of
files between small utility functions. 

All I had to do was build up a small collection of file processing
functions and glue them together to convert 1150 markdown files into HTML
pages. As it happens, [someone else had already started that work for
me][rioki]!

Starting from [Rioki's gulpfile.js][rioki2], I hacked and iterated until I had
a [gulpfile.js](https://github.com/lmorchard/blog.lmorchard.com/blob/master/gulpfile.js)
of my own and [a directory of small task modules](https://github.com/lmorchard/blog.lmorchard.com/tree/master/lib/tasks).
At this point, I've got a bunch of in-memory post indexes, date & tag based
archive pages, RSS feeds, and a handful of other templated pages. Oh, and I
can push all the content to an Amazon S3 bucket [with one command](https://github.com/lmorchard/blog.lmorchard.com/blob/master/gulpfile.js#L32).

It's also been really easy to break things up so [new & draft posts lead to
quick rebuilds when their files
change](https://github.com/lmorchard/blog.lmorchard.com/blob/master/lib/tasks/posts.js#L13) - and I can even [trigger a LiveReload
service](https://github.com/lmorchard/blog.lmorchard.com/blob/master/lib/tasks/posts.js#L29)
that keeps a browser tab updated as I make changes in Vim. That's better than
my experience with Jekyll and I like it so far more than Marked or Mou.

And, best of all, the whole thing feels nicely maintainable and fun to expand
in the future. I might even take a shot at spinning off all the code from the
content and release it as a standalone module installable from
[NPM](http://npmjs.org) in case anyone else wants to try it out.

## From WordPress and Jekyll to Gulp

I found [a WordPress-to-Jekyll exporter plugin][exporter]. It
generates a nice zip file download right from the site admin. That let me
dump the 50 posts I've accumulated since the last switch.

And, a great thing about the YAML-and-markdown file format used by Jekyll is
that I was able to merge these posts into the 1100 or so from 0xDECAFBAD just
by putting all the files into the same directory. So, I'm thinking
that I'll just revive my old blog by squashing it right on into the new, and
set up a handful of redirects to unify the whole mess.

## Sidebar loaded via AJAX

## Disqus and comment archival

## Amazon S3 deployment

## Next steps

* Write more, write more consistently
* Switch to Nunjucks

[bake]: http://www.aaronsw.com/weblog/000404
[rioki]: http://www.rioki.org/2014/06/09/jekyll-to-gulp.html
[antidatabase]: https://indiewebcamp.com/database-antipattern
[exporter]: https://github.com/benbalter/wordpress-to-jekyll-exporter
[platforms]: http://decafbad.com/blog/2011/06/08/moved-to-jekyll/

[gulp]: http://gulpjs.com/
[enthusiasm]: http://decafbad.com/blog/2006/05/26/confessions-of-a-serial-enthusiast
[sharpen]: https://www.stephencovey.com/7habits/7habits-habit7.php
[rioki2]: https://github.com/rioki/www.rioki.org/blob/master/gulpfile.js

<!-- vim: set wrap wm=5 syntax=mkd textwidth=78: -->
